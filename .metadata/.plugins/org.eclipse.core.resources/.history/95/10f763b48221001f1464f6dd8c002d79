<%@ page language="java" contentType="text/html charset=UTF8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>

<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>공지사항 목록</title>
	
	<style>  /* 여러 채팅창 간의 간격과 배열 위치*/  
	.float-left{    
		float:left;    
		margin: 5px;  
	}</style>

	
	<jsp:include page="../include/head.jsp"></jsp:include>
</head>
<body>
<div class="full-wrap">
    <!-- 헤더 부분 인클루드 -->
    <header id="hd">
    	<div class="container">
    		<jsp:include page="../include/hd.jsp"></jsp:include>
    	</div>
    </header>
    <main id="contents" class="contents">
 	    <section class="page" id="page1">
    		<h2 class="page-title">테스트</h2>
    		<div class="page-wrap">
    			<div class="" style="display:none; z-index:0;">    
    				<form>      <!-- 메시지 텍스트 박스 -->   
    					<h2>테스트</h2>   
    					<input type="text" class="message" onkeydown="if(event.keyCode === 13) return false;">      <!-- 전송 버튼 -->      
    					<input value="Send" type="button" class="sendBtn">    
    				</form>    
    				<br />    <!-- 서버와 메시지를 주고 받는 콘솔 텍스트 영역 -->    
    				<textarea rows="10" cols="50" class="console" disabled="disabled"></textarea>  
    			</div>  <!-- 소스를 간단하게 하기 위하 Jquery를 사용했습니다. -->  
    				
    			
    			
    			<script type="text/javascript">    // 서버의 broadsocket의 서블릿으로 웹 소켓을 한다. 
    			
    			var webSocket = new WebSocket("ws://localhost:8080/myapp/socket/admin");    // 콘솔 텍스트 영역    
    			var messageTextArea = document.getElementById("messageTextArea");    // 접속이 완료되면    
    			
    			webSocket.onopen = function(message) {      // 콘솔에 메시지를 남긴다.      
    				messageTextArea.value += "Server connect...\n";    
    				};    // 접속이 끝기는 경우는 브라우저를 닫는 경우이기 떄문에 이 이벤트는 의미가 없음.    
    				webSocket.onclose = function(message) {};    // 에러가 발생하면    
    				webSocket.onerror = function(message) {      // 콘솔에 메시지를 남긴다.      
    					messageTextArea.value += "error...\n";    
    				};    // 서버로부터 메시지가 도착하면 콘솔 화면에 메시지를 남긴다.    
    				webSocket.onmessage = function(message) {      
    					messageTextArea.value += "(operator) => " + message.data + "\n";    
    				};    
    				
    				
    				// 서버로 메시지를 발송하는 함수    
    				// Send 버튼을 누르거나 텍스트 박스에서 엔터를 치면 실행    
    						function sendMessage() {      // 텍스트 박스의 객체를 가져옴      
    							let message = document.getElementById("textMessage");      // 콘솔에 메세지를 남긴다.      
    							messageTextArea.value += "(me) => " + message.value + "\n";      // 소켓으로 보낸다.      
    							webSocket.send(message.value);      // 텍스트 박스 추기화      
    							message.value = "";    
    						}    // 텍스트 박스에서 엔터를 누르면    
    							function enter() {      // keyCode 13은 엔터이다.      
    								if(event.keyCode === 13) {        // 서버로 메시지 전송        
    									sendMessage();        // form에 의해 자동 submit을 막는다.        
    									return false;      
    								}      
    							return true;    
    							}  
    							
    			</script>

    		
    		</div>
    	</section>
    </main>
    <!-- 푸터 부분 인클루드 -->
    <footer id="ft">
    	<jsp:include page="../include/ft.jsp"></jsp:include>
    </footer>
</div>    
</body>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>  
</html>